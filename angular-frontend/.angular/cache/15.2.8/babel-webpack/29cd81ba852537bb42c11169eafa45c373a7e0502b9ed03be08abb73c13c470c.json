{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.InstalmentViewComponent = void 0;\nconst tslib_1 = require(\"tslib\");\nconst http_1 = require(\"@angular/common/http\");\nconst i0 = tslib_1.__importStar(require(\"@angular/core\"));\nconst i1 = tslib_1.__importStar(require(\"@angular/router\"));\nconst i2 = tslib_1.__importStar(require(\"app/layouts/service/customtoast.service\"));\nconst i3 = tslib_1.__importStar(require(\"app/shared/confirm/nsp-confirm.service\"));\nconst i4 = tslib_1.__importStar(require(\"app/payment/instalment/service/instalment.service\"));\nconst i5 = tslib_1.__importStar(require(\"app/payment/overpayment/service/payment.service\"));\nconst i6 = tslib_1.__importStar(require(\"app/shared/service/file-upload.service\"));\nconst i7 = tslib_1.__importStar(require(\"primeng/api\"));\nconst i8 = tslib_1.__importStar(require(\"primeng/button\"));\nconst i9 = tslib_1.__importStar(require(\"primeng/tooltip\"));\nconst i10 = tslib_1.__importStar(require(\"primeng/table\"));\nconst i11 = tslib_1.__importStar(require(\"primeng/confirmpopup\"));\nconst i12 = tslib_1.__importStar(require(\"primeng/panel\"));\nconst i13 = tslib_1.__importStar(require(\"primeng/ripple\"));\nconst i14 = tslib_1.__importStar(require(\"@angular/common\"));\nconst i15 = tslib_1.__importStar(require(\"../../../shared/pipe/default-string.pipe\"));\nfunction InstalmentViewComponent_ng_template_52_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n    i0.ɵɵtext(0, \"\\n        \");\n    i0.ɵɵelementStart(1, \"div\", 12);\n    i0.ɵɵtext(2, \"\\n          \");\n    i0.ɵɵelementStart(3, \"button\", 13);\n    i0.ɵɵlistener(\"click\", function InstalmentViewComponent_ng_template_52_Template_button_click_3_listener() {\n      i0.ɵɵrestoreView(_r5);\n      const ctx_r4 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r4.exportCSV());\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(4, \"\\n        \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(5, \"\\n        \");\n    i0.ɵɵelement(6, \"p-confirmPopup\", 14);\n    i0.ɵɵtext(7, \"\\n      \");\n  }\n}\nfunction InstalmentViewComponent_ng_template_54_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtext(0, \"\\n        \");\n    i0.ɵɵelementStart(1, \"tr\");\n    i0.ɵɵtext(2, \"\\n\\n          \");\n    i0.ɵɵelementStart(3, \"th\", 15);\n    i0.ɵɵtext(4, \"SN\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(5, \"\\n          \");\n    i0.ɵɵelementStart(6, \"th\", 16);\n    i0.ɵɵtext(7, \"Collection Date\\n            \");\n    i0.ɵɵelement(8, \"p-sortIcon\", 17);\n    i0.ɵɵtext(9, \"\\n          \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(10, \"\\n          \");\n    i0.ɵɵelementStart(11, \"th\", 18);\n    i0.ɵɵtext(12, \"Amount\\n            \");\n    i0.ɵɵelement(13, \"p-sortIcon\", 19);\n    i0.ɵɵtext(14, \"\\n          \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(15, \"\\n          \");\n    i0.ɵɵelementStart(16, \"th\", 20);\n    i0.ɵɵtext(17, \"Status\\n            \");\n    i0.ɵɵelement(18, \"p-sortIcon\", 21);\n    i0.ɵɵtext(19, \"\\n          \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(20, \"\\n          \");\n    i0.ɵɵelementStart(21, \"th\", 22);\n    i0.ɵɵtext(22, \"Principal O/S Refunded\\n            \");\n    i0.ɵɵelement(23, \"p-sortIcon\", 23);\n    i0.ɵɵtext(24, \"\\n          \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(25, \"\\n          \");\n    i0.ɵɵelementStart(26, \"th\", 24);\n    i0.ɵɵtext(27, \"Interest O/S Refunded\\n            \");\n    i0.ɵɵelement(28, \"p-sortIcon\", 25);\n    i0.ɵɵtext(29, \"\\n          \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(30, \"\\n          \");\n    i0.ɵɵelementStart(31, \"th\", 26);\n    i0.ɵɵtext(32, \"Excess Refund\\n            \");\n    i0.ɵɵelement(33, \"p-sortIcon\", 27);\n    i0.ɵɵtext(34, \"\\n          \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(35, \"\\n        \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(36, \"\\n      \");\n  }\n}\nfunction InstalmentViewComponent_ng_template_56_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtext(0, \"\\n        \");\n    i0.ɵɵelementStart(1, \"tr\");\n    i0.ɵɵtext(2, \"\\n          \");\n    i0.ɵɵelementStart(3, \"td\")(4, \"a\", 28);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtext(6, \"\\n          \");\n    i0.ɵɵelementStart(7, \"td\");\n    i0.ɵɵtext(8);\n    i0.ɵɵpipe(9, \"defaultString\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(10, \"\\n          \");\n    i0.ɵɵelementStart(11, \"td\");\n    i0.ɵɵtext(12);\n    i0.ɵɵpipe(13, \"defaultString\");\n    i0.ɵɵpipe(14, \"currency\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(15, \"\\n          \");\n    i0.ɵɵelementStart(16, \"td\");\n    i0.ɵɵtext(17);\n    i0.ɵɵpipe(18, \"defaultString\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(19, \"\\n          \");\n    i0.ɵɵelementStart(20, \"td\");\n    i0.ɵɵtext(21);\n    i0.ɵɵpipe(22, \"defaultString\");\n    i0.ɵɵpipe(23, \"currency\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(24, \"\\n          \");\n    i0.ɵɵelementStart(25, \"td\");\n    i0.ɵɵtext(26);\n    i0.ɵɵpipe(27, \"defaultString\");\n    i0.ɵɵpipe(28, \"currency\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(29, \"\\n          \");\n    i0.ɵɵelementStart(30, \"td\");\n    i0.ɵɵtext(31);\n    i0.ɵɵpipe(32, \"defaultString\");\n    i0.ɵɵpipe(33, \"currency\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(34, \"\\n        \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(35, \"\\n      \");\n  }\n  if (rf & 2) {\n    const refundRecord_r6 = ctx.$implicit;\n    const i_r7 = ctx.rowIndex;\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(i_r7 + 1);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(9, 7, refundRecord_r6 == null ? null : refundRecord_r6.paydayDate));\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(13, 9, i0.ɵɵpipeBind3(14, 11, refundRecord_r6 == null ? null : refundRecord_r6.refundActualAmt, \"SGD\", \"\")));\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(18, 15, refundRecord_r6 == null ? null : refundRecord_r6.refundStatus));\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(22, 17, i0.ɵɵpipeBind3(23, 19, refundRecord_r6 == null ? null : refundRecord_r6.refundPrincipalAmt, \"SGD\", \"\")));\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(27, 23, i0.ɵɵpipeBind3(28, 25, refundRecord_r6 == null ? null : refundRecord_r6.refundInterestAmt, \"SGD\", \"\")));\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(32, 29, i0.ɵɵpipeBind3(33, 31, refundRecord_r6 == null ? null : refundRecord_r6.refundExcessAmt, \"SGD\", \"\")));\n  }\n}\nfunction InstalmentViewComponent_ng_template_58_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtext(0, \"\\n        \");\n    i0.ɵɵelementStart(1, \"tr\");\n    i0.ɵɵtext(2, \"\\n          \");\n    i0.ɵɵelementStart(3, \"td\", 29);\n    i0.ɵɵtext(4, \"No Refund records found for this Instalment Plan.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(5, \"\\n        \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(6, \"\\n      \");\n  }\n}\nconst _c0 = function () {\n  return [10, 25, 50];\n};\nclass InstalmentViewComponent {\n  constructor(route, toastService, nspConfirmService, instalmentService, paymentService, fileUploadService) {\n    this.route = route;\n    this.toastService = toastService;\n    this.nspConfirmService = nspConfirmService;\n    this.instalmentService = instalmentService;\n    this.paymentService = paymentService;\n    this.fileUploadService = fileUploadService;\n    this.summary = {\n      nric: '',\n      name: '',\n      rank: '',\n      sex: '',\n      csn: '',\n      principalOS: 0,\n      interestOS: 0\n    };\n  }\n  ngOnInit() {\n    this.route.params.subscribe(params => {\n      // Call API endpoint to retrieve the Instalment record\n      this.instalmentService.getInstalment(params['instalmentId']).subscribe(res => {\n        // Pipe response to an array of Interface model\n        this.instalmentPlan = res.body.data;\n        // console.log (this.instalmentPlan)\n        // Sequentially call other APIs using the NRIC for the Instalment plan\n        this.paymentService.getSummaryByNric(this.instalmentPlan?.nric).subscribe(summaryRes => {\n          this.summary = summaryRes.body.data;\n        });\n      }, error => {\n        console.log(error.message);\n        if (error.status === 404 /* HttpStatusCode.NotFound */) {\n          this.toastService.add({\n            severity: 'error',\n            summary: 'Error',\n            detail: 'No Instalment record found'\n          });\n        }\n      });\n    });\n  }\n  exportCSV() {\n    // TODO: Implement export CSV function or call it from a utility class\n  }\n  downloadSupportingDocuments() {\n    const fileIds = this.instalmentPlan.supportingDocs?.map(x => String(x.documentId));\n    if (fileIds) {\n      this.fileUploadService.downloadZip(fileIds).subscribe(res => {\n        if (res) {\n          const data = res;\n          const contentDispositionHeader = data.headers.get('content-disposition');\n          const fileName = contentDispositionHeader.split(';')[1].trim().split('=')[1].replace(/\"/g, '');\n          const blob = new Blob([data.body], {\n            type: data.headers.get('content-type')\n          });\n          const anchor = document.createElement(\"a\");\n          anchor.href = URL.createObjectURL(blob);\n          anchor.download = fileName;\n          anchor.click();\n        }\n      }, error => {\n        if (error.HttpStatusCode === 404 /* HttpStatusCode.NotFound */) {\n          this.toastService.error(error.error?.error_desc);\n        }\n      });\n    } else {\n      console.log(\"no documents\");\n    }\n  }\n}\nexports.InstalmentViewComponent = InstalmentViewComponent;\nInstalmentViewComponent.ɵfac = function InstalmentViewComponent_Factory(t) {\n  return new (t || InstalmentViewComponent)(i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i2.CustomToastService), i0.ɵɵdirectiveInject(i3.NspConfirmationService), i0.ɵɵdirectiveInject(i4.InstalmentService), i0.ɵɵdirectiveInject(i5.PaymentService), i0.ɵɵdirectiveInject(i6.FileUploadService));\n};\nInstalmentViewComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: InstalmentViewComponent,\n  selectors: [[\"n2-instalment-view\"]],\n  decls: 63,\n  vars: 37,\n  consts: [[1, \"flex\", \"flex-column\", \"gap-4\"], [\"header\", \"Personal Particulars\"], [1, \"particulars\"], [3, \"header\"], [1, \"flex\", \"justify-content-between\", \"align-items-center\"], [1, \"flex\", \"gap-4\"], [\"type\", \"button\", \"pButton\", \"\", \"pRipple\", \"\", \"icon\", \"pi pi-download\", \"iconPos\", \"left\", \"label\", \"Supporting Documents\", \"pTooltip\", \"Download Supporting Documents\", \"tooltipPosition\", \"bottom\", 3, \"click\"], [\"styleClass\", \"p-datatable-gridlines\", \"currentPageReportTemplate\", \"Showing {first} to {last} of {totalRecords} entries\", 3, \"value\", \"paginator\", \"rows\", \"rowsPerPageOptions\", \"showCurrentPageReport\"], [\"pTemplate\", \"caption\"], [\"pTemplate\", \"header\"], [\"pTemplate\", \"body\"], [\"pTemplate\", \"emptymessage\"], [1, \"flex\", \"justify-content-between\"], [\"type\", \"button\", \"pButton\", \"\", \"pRipple\", \"\", \"icon\", \"pi pi-file\", \"pTooltip\", \"Export as CSV\", \"tooltipPosition\", \"bottom\", 3, \"click\"], [\"key\", \"terminateInstalmentRecords\"], [\"scope\", \"col\", 2, \"width\", \"5%\"], [\"scope\", \"col\", \"pSortableColumn\", \"date\"], [\"field\", \"date\"], [\"scope\", \"col\", \"pSortableColumn\", \"amount\"], [\"field\", \"amount\"], [\"scope\", \"col\", \"pSortableColumn\", \"status\"], [\"field\", \"status\"], [\"scope\", \"col\", \"pSortableColumn\", \"principalRefunded\"], [\"field\", \"principalRefunded\"], [\"scope\", \"col\", \"pSortableColumn\", \"interestRefunded\"], [\"field\", \"interestRefunded\"], [\"scope\", \"col\", \"pSortableColumn\", \"excessRefundAmt\"], [\"field\", \"excessRefundAmt\"], [3, \"routerLink\"], [\"colspan\", \"7\"]],\n  template: function InstalmentViewComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0);\n      i0.ɵɵtext(1, \"\\n  \");\n      i0.ɵɵelementStart(2, \"p-panel\", 1);\n      i0.ɵɵtext(3, \"\\n    \");\n      i0.ɵɵelementStart(4, \"div\", 2);\n      i0.ɵɵtext(5, \"\\n      \");\n      i0.ɵɵelementStart(6, \"h5\");\n      i0.ɵɵtext(7);\n      i0.ɵɵpipe(8, \"defaultString\");\n      i0.ɵɵpipe(9, \"defaultString\");\n      i0.ɵɵpipe(10, \"defaultString\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(11, \"\\n\");\n      i0.ɵɵtext(12, \"\\n\");\n      i0.ɵɵtext(13, \"\\n\");\n      i0.ɵɵtext(14, \"\\n    \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(15, \"\\n  \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(16, \"\\n\\n  \");\n      i0.ɵɵelementStart(17, \"p-panel\", 3);\n      i0.ɵɵtext(18, \"\\n    \");\n      i0.ɵɵelementStart(19, \"div\", 4);\n      i0.ɵɵtext(20, \"\\n      \");\n      i0.ɵɵelementStart(21, \"div\", 5);\n      i0.ɵɵtext(22, \"\\n        \");\n      i0.ɵɵelementStart(23, \"span\");\n      i0.ɵɵtext(24, \"Outstanding Principal:\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(25, \"span\");\n      i0.ɵɵtext(26);\n      i0.ɵɵpipe(27, \"defaultString\");\n      i0.ɵɵpipe(28, \"currency\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(29, \"\\n        \");\n      i0.ɵɵelementStart(30, \"span\");\n      i0.ɵɵtext(31, \"Outstanding Interest:\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(32, \"span\");\n      i0.ɵɵtext(33);\n      i0.ɵɵpipe(34, \"defaultString\");\n      i0.ɵɵpipe(35, \"currency\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(36, \"\\n        \");\n      i0.ɵɵelementStart(37, \"span\");\n      i0.ɵɵtext(38, \"Outstanding Amount:\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(39, \"span\");\n      i0.ɵɵtext(40);\n      i0.ɵɵpipe(41, \"defaultString\");\n      i0.ɵɵpipe(42, \"currency\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(43, \"\\n      \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(44, \"\\n      \");\n      i0.ɵɵelementStart(45, \"button\", 6);\n      i0.ɵɵlistener(\"click\", function InstalmentViewComponent_Template_button_click_45_listener() {\n        return ctx.downloadSupportingDocuments();\n      });\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(46, \"\\n    \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(47, \"\\n    \");\n      i0.ɵɵelement(48, \"br\");\n      i0.ɵɵtext(49, \"\\n    \");\n      i0.ɵɵelementStart(50, \"p-table\", 7);\n      i0.ɵɵtext(51, \"\\n      \");\n      i0.ɵɵtemplate(52, InstalmentViewComponent_ng_template_52_Template, 8, 0, \"ng-template\", 8);\n      i0.ɵɵtext(53, \"\\n      \");\n      i0.ɵɵtemplate(54, InstalmentViewComponent_ng_template_54_Template, 37, 0, \"ng-template\", 9);\n      i0.ɵɵtext(55, \"\\n      \");\n      i0.ɵɵtemplate(56, InstalmentViewComponent_ng_template_56_Template, 36, 35, \"ng-template\", 10);\n      i0.ɵɵtext(57, \"\\n\\n      \");\n      i0.ɵɵtemplate(58, InstalmentViewComponent_ng_template_58_Template, 7, 0, \"ng-template\", 11);\n      i0.ɵɵtext(59, \"\\n    \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(60, \"\\n  \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(61, \"\\n\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(62, \"\\n\");\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(7);\n      i0.ɵɵtextInterpolate3(\"\", i0.ɵɵpipeBind1(8, 12, ctx.instalmentPlan == null ? null : ctx.instalmentPlan.nric), \"   \", i0.ɵɵpipeBind1(9, 14, ctx.summary == null ? null : ctx.summary.rank), \"   \", i0.ɵɵpipeBind1(10, 16, ctx.summary == null ? null : ctx.summary.name), \"\");\n      i0.ɵɵadvance(10);\n      i0.ɵɵpropertyInterpolate1(\"header\", \"Instalment Plan: \", ctx.instalmentPlan == null ? null : ctx.instalmentPlan.id, \"\");\n      i0.ɵɵadvance(9);\n      i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(27, 18, i0.ɵɵpipeBind3(28, 20, ctx.summary == null ? null : ctx.summary.principalOS, \"SGD\", \"\")));\n      i0.ɵɵadvance(7);\n      i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(34, 24, i0.ɵɵpipeBind3(35, 26, ctx.summary == null ? null : ctx.summary.interestOS, \"SGD\", \"\")));\n      i0.ɵɵadvance(7);\n      i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(41, 30, i0.ɵɵpipeBind3(42, 32, (ctx.summary == null ? null : ctx.summary.principalOS) + (ctx.summary == null ? null : ctx.summary.interestOS), \"SGD\", \"\")));\n      i0.ɵɵadvance(10);\n      i0.ɵɵproperty(\"value\", ctx.instalmentPlan == null ? null : ctx.instalmentPlan.overpaymentRefunds)(\"paginator\", true)(\"rows\", 5)(\"rowsPerPageOptions\", i0.ɵɵpureFunction0(36, _c0))(\"showCurrentPageReport\", true);\n    }\n  },\n  dependencies: [i1.RouterLink, i7.PrimeTemplate, i8.ButtonDirective, i9.Tooltip, i10.Table, i10.SortableColumn, i10.SortIcon, i11.ConfirmPopup, i12.Panel, i13.Ripple, i14.CurrencyPipe, i15.DefaultStringPipe],\n  styles: [\".particulars[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%], .particulars[_ngcontent-%COMP%]   span[_ngcontent-%COMP%] {\\n  display: inline !important;\\n  padding: 16px;\\n}\\n\\n  .p-tooltip {\\n  max-width: -moz-fit-content;\\n  max-width: fit-content;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluc3RhbG1lbnQtdmlldy5jb21wb25lbnQuc2NzcyIsIi4uXFwuLlxcLi5cXC4uXFwuLlxcLi5cXC4uXFwuLlxcLi5cXHByb2plY3RzJTIwMlxcbnNwYXlpaWFwcFxcc3JjXFxtYWluXFx3ZWJhcHBcXGFwcFxccGF5bWVudFxcaW5zdGFsbWVudFxcaW5zdGFsbWVudC12aWV3XFxpbnN0YWxtZW50LXZpZXcuY29tcG9uZW50LnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDRSwwQkFBQTtFQUNBLGFBQUE7QUNDRjs7QURHRTtFQUNFLDJCQUFBO0VBQUEsc0JBQUE7QUNBSiIsImZpbGUiOiJpbnN0YWxtZW50LXZpZXcuY29tcG9uZW50LnNjc3MiLCJzb3VyY2VzQ29udGVudCI6WyIucGFydGljdWxhcnMgaDUsIC5wYXJ0aWN1bGFycyBzcGFuIHtcclxuICBkaXNwbGF5OiBpbmxpbmUgIWltcG9ydGFudDtcclxuICBwYWRkaW5nOiAxNnB4O1xyXG59XHJcblxyXG46Om5nLWRlZXAge1xyXG4gIC5wLXRvb2x0aXAge1xyXG4gICAgbWF4LXdpZHRoOiBmaXQtY29udGVudDtcclxuICB9XHJcbn1cclxuIiwiLnBhcnRpY3VsYXJzIGg1LCAucGFydGljdWxhcnMgc3BhbiB7XG4gIGRpc3BsYXk6IGlubGluZSAhaW1wb3J0YW50O1xuICBwYWRkaW5nOiAxNnB4O1xufVxuXG46Om5nLWRlZXAgLnAtdG9vbHRpcCB7XG4gIG1heC13aWR0aDogZml0LWNvbnRlbnQ7XG59Il19 */\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9tYWluL3dlYmFwcC9hcHAvcGF5bWVudC9pbnN0YWxtZW50L2luc3RhbG1lbnQtdmlldy9pbnN0YWxtZW50LXZpZXcuY29tcG9uZW50LnNjc3MiLCJ3ZWJwYWNrOi8vLi8uLi8uLi9wcm9qZWN0cyUyMDIvbnNwYXlpaWFwcC9zcmMvbWFpbi93ZWJhcHAvYXBwL3BheW1lbnQvaW5zdGFsbWVudC9pbnN0YWxtZW50LXZpZXcvaW5zdGFsbWVudC12aWV3LmNvbXBvbmVudC5zY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0VBQ0UsMEJBQUE7RUFDQSxhQUFBO0FDQ0Y7O0FER0U7RUFDRSwyQkFBQTtFQUFBLHNCQUFBO0FDQUo7QURFQSw0OEJBQTQ4QiIsInNvdXJjZXNDb250ZW50IjpbIi5wYXJ0aWN1bGFycyBoNSwgLnBhcnRpY3VsYXJzIHNwYW4ge1xyXG4gIGRpc3BsYXk6IGlubGluZSAhaW1wb3J0YW50O1xyXG4gIHBhZGRpbmc6IDE2cHg7XHJcbn1cclxuXHJcbjo6bmctZGVlcCB7XHJcbiAgLnAtdG9vbHRpcCB7XHJcbiAgICBtYXgtd2lkdGg6IGZpdC1jb250ZW50O1xyXG4gIH1cclxufVxyXG4iLCIucGFydGljdWxhcnMgaDUsIC5wYXJ0aWN1bGFycyBzcGFuIHtcbiAgZGlzcGxheTogaW5saW5lICFpbXBvcnRhbnQ7XG4gIHBhZGRpbmc6IDE2cHg7XG59XG5cbjo6bmctZGVlcCAucC10b29sdGlwIHtcbiAgbWF4LXdpZHRoOiBmaXQtY29udGVudDtcbn0iXSwic291cmNlUm9vdCI6IiJ9 */\"]\n});","map":{"version":3,"mappings":"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","names":["i0","InstalmentViewComponent","constructor","route","toastService","nspConfirmService","instalmentService","paymentService","fileUploadService","nric","name","rank","sex","csn","principalOS","interestOS","ngOnInit","params","subscribe","getInstalment","res","instalmentPlan","body","data","getSummaryByNric","summaryRes","summary","error","console","log","message","status","add","severity","detail","exportCSV","downloadSupportingDocuments","fileIds","supportingDocs","map","x","String","documentId","downloadZip","contentDispositionHeader","headers","get","fileName","split","trim","replace","blob","Blob","type","anchor","document","createElement","href","URL","createObjectURL","download","click","HttpStatusCode","error_desc","exports","selectors","decls","vars","consts","template","ctx"],"sourceRoot":"","sources":["C:\\Users\\D1347074\\Desktop\\projects 2\\nspayiiapp\\src\\main\\webapp\\app\\payment\\instalment\\instalment-view\\instalment-view.component.ts","C:\\Users\\D1347074\\Desktop\\projects 2\\nspayiiapp\\src\\main\\webapp\\app\\payment\\instalment\\instalment-view\\instalment-view.component.html"],"sourcesContent":["import {Component, OnInit} from '@angular/core';\r\nimport {HttpErrorResponse, HttpResponse, HttpStatusCode} from '@angular/common/http';\r\nimport {CustomToastService} from 'app/layouts/service/customtoast.service';\r\nimport {NspConfirmationService} from 'app/shared/confirm/nsp-confirm.service';\r\nimport {InstalmentService} from 'app/payment/instalment/service/instalment.service';\r\nimport {ActivatedRoute} from '@angular/router';\r\nimport {IInstalmentRecord} from 'app/payment/instalment/model/instalment-record.model';\r\nimport {PaymentService} from \"app/payment/overpayment/service/payment.service\";\r\nimport {IOPSummary} from \"app/payment/overpayment/overpayment-info/overpayment-info.model\";\r\nimport { FileUploadService } from 'app/shared/service/file-upload.service';\r\n\r\n@Component({\r\n  selector: 'n2-instalment-view',\r\n  templateUrl: './instalment-view.component.html',\r\n  styleUrls: ['./instalment-view.component.scss']\r\n})\r\nexport class InstalmentViewComponent implements OnInit {\r\n  instalmentPlan: IInstalmentRecord;\r\n  summary: IOPSummary = {\r\n    nric: '',\r\n    name: '',\r\n    rank: '',\r\n    sex: '',\r\n    csn: '',\r\n    principalOS: 0,\r\n    interestOS: 0\r\n  };\r\n\r\n  constructor(\r\n    private route: ActivatedRoute,\r\n    private toastService: CustomToastService,\r\n    private nspConfirmService: NspConfirmationService,\r\n    private instalmentService: InstalmentService,\r\n    private paymentService: PaymentService,\r\n    private fileUploadService: FileUploadService\r\n  ) {\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.route.params.subscribe(params => {\r\n      // Call API endpoint to retrieve the Instalment record\r\n      this.instalmentService.getInstalment(params['instalmentId']).subscribe(\r\n        (res: HttpResponse<any>) => {\r\n          // Pipe response to an array of Interface model\r\n          this.instalmentPlan = res.body.data;\r\n          // console.log (this.instalmentPlan)\r\n          // Sequentially call other APIs using the NRIC for the Instalment plan\r\n          this.paymentService.getSummaryByNric(this.instalmentPlan?.nric).subscribe(\r\n            (summaryRes: HttpResponse<any>) => {\r\n              this.summary = summaryRes.body.data;\r\n            }\r\n          );\r\n        },\r\n        (error: HttpErrorResponse) => {\r\n          console.log(error.message);\r\n          if (error.status === HttpStatusCode.NotFound) {\r\n            this.toastService.add({\r\n              severity: 'error',\r\n              summary: 'Error',\r\n              detail: 'No Instalment record found'\r\n            });\r\n          }\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  exportCSV(): void {\r\n    // TODO: Implement export CSV function or call it from a utility class\r\n  }\r\n\r\n  downloadSupportingDocuments(): void {\r\n    const fileIds = this.instalmentPlan.supportingDocs?.map(x => String(x.documentId));\r\n\r\n    if(fileIds) {\r\n      this.fileUploadService.downloadZip(fileIds).subscribe(\r\n        res => {\r\n          if(res) {\r\n            const data = res;\r\n            const contentDispositionHeader: string = data.headers.get('content-disposition');\r\n            const fileName = contentDispositionHeader.split(';')[1].trim().split('=')[1].replace(/\"/g, '');        \r\n            const blob = new Blob([data.body], { type: data.headers.get('content-type')});\r\n            const anchor = document.createElement(\"a\");\r\n            anchor.href = URL.createObjectURL(blob);\r\n            anchor.download = fileName;\r\n            anchor.click();\r\n          }\r\n        },\r\n        error => {\r\n          if(error.HttpStatusCode === HttpStatusCode.NotFound) {\r\n            this.toastService.error(error.error?.error_desc);\r\n          }\r\n        }\r\n      );\r\n    } else {\r\n      console.log(\"no documents\");\r\n    }\r\n  }\r\n}\r\n","<div class='flex flex-column gap-4'>\r\n  <p-panel header='Personal Particulars'>\r\n    <div class='particulars'>\r\n      <h5>{{instalmentPlan?.nric | defaultString}}   {{summary?.rank | defaultString}}   {{summary?.name | defaultString}}</h5>\r\n<!--      <span>{{instalmentPlan?.tos | defaultString}}</span>-->\r\n<!--      <span>CAB:</span><span>{{instalmentPlan?.cabFlag | defaultString}}</span>-->\r\n<!--      <span>Instalment Bank Account:</span><span>{{instalmentPlan?.bankAccount | defaultString}}</span>-->\r\n    </div>\r\n  </p-panel>\r\n\r\n  <p-panel header='Instalment Plan: {{instalmentPlan?.id}}'>\r\n    <div class='flex justify-content-between align-items-center'>\r\n      <div class='flex gap-4'>\r\n        <span>Outstanding Principal:</span><span>{{summary?.principalOS | currency:'SGD':'' | defaultString}}</span>\r\n        <span>Outstanding Interest:</span><span>{{summary?.interestOS | currency:'SGD':'' | defaultString}}</span>\r\n        <span>Outstanding Amount:</span><span>{{summary?.principalOS + summary?.interestOS | currency:'SGD':'' | defaultString}}</span>\r\n      </div>\r\n      <button type='button' pButton pRipple icon='pi pi-download' iconPos='left' label='Supporting Documents'\r\n              (click)='downloadSupportingDocuments()' pTooltip='Download Supporting Documents'\r\n              tooltipPosition='bottom'></button>\r\n    </div>\r\n    <br>\r\n    <p-table\r\n            [value]='instalmentPlan?.overpaymentRefunds!' styleClass='p-datatable-gridlines' [paginator]='true' [rows]='5'\r\n            currentPageReportTemplate='Showing {first} to {last} of {totalRecords} entries'\r\n            [rowsPerPageOptions]='[10,25,50]' [showCurrentPageReport]='true'>\r\n      <ng-template pTemplate='caption'>\r\n        <div class='flex justify-content-between'>\r\n          <button type='button' pButton pRipple icon='pi pi-file' (click)='exportCSV()' pTooltip='Export as CSV'\r\n                  tooltipPosition='bottom'></button>\r\n        </div>\r\n        <p-confirmPopup key='terminateInstalmentRecords'></p-confirmPopup>\r\n      </ng-template>\r\n      <ng-template pTemplate='header'>\r\n        <tr>\r\n\r\n          <th scope=\"col\" style='width: 5%'>SN</th>\r\n          <th scope=\"col\" pSortableColumn='date'>Collection Date\r\n            <p-sortIcon field='date'></p-sortIcon>\r\n          </th>\r\n          <th scope=\"col\" pSortableColumn='amount'>Amount\r\n            <p-sortIcon field='amount'></p-sortIcon>\r\n          </th>\r\n          <th scope=\"col\" pSortableColumn='status'>Status\r\n            <p-sortIcon field='status'></p-sortIcon>\r\n          </th>\r\n          <th scope=\"col\" pSortableColumn='principalRefunded'>Principal O/S Refunded\r\n            <p-sortIcon field='principalRefunded'></p-sortIcon>\r\n          </th>\r\n          <th scope=\"col\" pSortableColumn='interestRefunded'>Interest O/S Refunded\r\n            <p-sortIcon field='interestRefunded'></p-sortIcon>\r\n          </th>\r\n          <th scope=\"col\" pSortableColumn='excessRefundAmt'>Excess Refund\r\n            <p-sortIcon field='excessRefundAmt'></p-sortIcon>\r\n          </th>\r\n        </tr>\r\n      </ng-template>\r\n      <ng-template pTemplate='body' let-refundRecord let-i='rowIndex'>\r\n        <tr>\r\n          <td><a [routerLink]=''>{{i + 1}}</a></td>\r\n          <td>{{refundRecord?.paydayDate | defaultString}}</td>\r\n          <td>{{refundRecord?.refundActualAmt | currency:'SGD':'' | defaultString}}</td>\r\n          <td>{{refundRecord?.refundStatus | defaultString}}</td>\r\n          <td>{{refundRecord?.refundPrincipalAmt | currency:'SGD':'' | defaultString}}</td>\r\n          <td>{{refundRecord?.refundInterestAmt | currency:'SGD':'' | defaultString}}</td>\r\n          <td>{{refundRecord?.refundExcessAmt | currency:'SGD':'' | defaultString}}</td>\r\n        </tr>\r\n      </ng-template>\r\n\r\n      <ng-template pTemplate='emptymessage'>\r\n        <tr>\r\n          <td colspan='7'>No Refund records found for this Instalment Plan.</td>\r\n        </tr>\r\n      </ng-template>\r\n    </p-table>\r\n  </p-panel>\r\n</div>\r\n"]},"metadata":{},"sourceType":"script","externalDependencies":[]}